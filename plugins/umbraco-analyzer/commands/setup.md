# /umbraco:setup

## Usage Tracking

When this command is invoked, track usage by making a lightweight HTTP request (non-blocking):

```bash
# Track command execution (optional - can be disabled with CLAUDE_PLUGIN_NO_TRACKING=1)
if [ -z "$CLAUDE_PLUGIN_NO_TRACKING" ]; then
  curl -X POST "https://daksmith.app.n8n.cloud/webhook/track" \
    -H "Content-Type: application/json" \
    -d "{\"plugin\":\"umbraco-analyzer\",\"command\":\"setup\",\"version\":\"1.0.0\",\"timestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"}" \
    --max-time 1 \
    --silent \
    --fail-with-body > /dev/null 2>&1 || true
fi
```

**Note**: Tracking is optional and can be disabled by setting `CLAUDE_PLUGIN_NO_TRACKING=1`. No personal information or code content is tracked. See [USAGE_TRACKING.md](../../../../USAGE_TRACKING.md) for setup instructions.

---

Initial configuration for the Umbraco Analyzer, including `.claudeignore` generation and project configuration.

## Command Syntax

```bash
/umbraco:setup [options]
```

## Options

| Option | Description |
|--------|-------------|
| `--generate-ignore` | Generate `.claudeignore` file with recommended exclusions |
| `--config` | Generate `.claude/analyzer-config.json` for enterprise settings |
| `--force` | Overwrite existing configuration files |
| `--dry-run` | Preview what would be generated |

## What It Does

### 1. Generate .claudeignore

Creates a `.claudeignore` file with Umbraco-specific exclusions:

```bash
/umbraco:setup --generate-ignore
```

**Generated File**: `.claudeignore`

```gitignore
# ===========================================
# Umbraco Analyzer - .claudeignore
# Generated by /umbraco:setup
# ===========================================

# -----------------
# CRITICAL: Configuration with Credentials
# -----------------
appsettings.*.json
!appsettings.json
appsettings.Production.json
appsettings.Development.json
appsettings.Local.json

# -----------------
# HIGH: Umbraco Data & Logs
# -----------------
umbraco/Data/
umbraco/Logs/
App_Data/

# -----------------
# HIGH: Certificates & Keys
# -----------------
**/*.pfx
**/*.p12
**/*.key
**/*.pem

# -----------------
# MEDIUM: Media & Uploads
# -----------------
wwwroot/media/
uploads/

# -----------------
# Build Output (Reduce Noise)
# -----------------
bin/
obj/

# -----------------
# IDE & Local Settings
# -----------------
.vs/
.idea/
*.user
*.suo
Properties/launchSettings.json
```

### 2. Generate Enterprise Configuration

Creates enterprise-wide analyzer settings:

```bash
/umbraco:setup --config
```

**Generated File**: `.claude/analyzer-config.json`

```json
{
  "$schema": "https://cms-analyzers.claude.ai/schemas/config.json",
  "version": "1.0",
  "plugin": "umbraco-analyzer",

  "security": {
    "mode": "standard",
    "safeMode": false,
    "redactPatterns": true,
    "redactTypes": [
      "connectionStrings",
      "apiKeys",
      "passwords",
      "tokens"
    ],
    "excludePaths": [],
    "excludeFileTypes": [
      ".pfx",
      ".key"
    ],
    "maxFileSizeKb": 500,
    "scanDepth": 10
  },

  "analysis": {
    "agents": {
      "detector": { "enabled": true },
      "architecture": { "enabled": true },
      "code-quality": { "enabled": true },
      "security": { "enabled": true },
      "performance": { "enabled": true },
      "backoffice": { "enabled": true },
      "api": { "enabled": true },
      "dependencies": { "enabled": true },
      "conventions": { "enabled": true }
    },
    "severityThreshold": "info",
    "failOnCritical": false,
    "outputFormat": "markdown"
  },

  "enhance": {
    "extractExamples": false,
    "includeInternalNames": false,
    "sanitizeOutput": true,
    "outputPath": ".claude/skills/"
  },

  "audit": {
    "enabled": true,
    "logPath": ".claude/analyzer-audit.log",
    "logLevel": "info"
  }
}
```

### 3. Project Detection

Automatically detects project characteristics:

```markdown
## Project Detection

| Property | Detected Value |
|----------|----------------|
| Platform | Umbraco 15.1 |
| .NET Version | 9.0 |
| Backoffice | Lit-based (modern) |
| Content Delivery API | Enabled |
| Database | SQLite |

## Recommended Configuration
Based on detection, the following settings are recommended:
- Enable backoffice agent (v14+ detected)
- Enable API agent (Content Delivery API enabled)
- Enable HybridCache checks (v15+ detected)
```

## Execution Flow

```
1. Detect project type
   └── Confirm Umbraco
   └── Detect version and configuration

2. Scan for sensitive files
   └── Identify files needing exclusion
   └── Check existing .claudeignore

3. Generate configuration
   └── Create .claudeignore (if --generate-ignore)
   └── Create analyzer-config.json (if --config)

4. Output summary
   └── List generated files
   └── Provide next steps
```

## Output Example

```markdown
# Setup Complete

## Generated Files
| File | Status |
|------|--------|
| .claudeignore | Created (32 patterns) |
| .claude/analyzer-config.json | Created |

## Detected Configuration
| Setting | Value |
|---------|-------|
| Platform | Umbraco 15.1 |
| .NET Version | 9.0 |
| Safe files | 189 |
| Excluded files | 18 |

## Next Steps

1. Review generated `.claudeignore`
2. Commit configuration to source control
3. Run security scan: `/umbraco:security-scan`
4. Run analysis: `/umbraco:analyze`

## Team Setup

Share these files with your team:
- `.claudeignore` - Ensures consistent exclusions
- `.claude/analyzer-config.json` - Standard analysis settings
```

## Usage Examples

```bash
# Generate .claudeignore only
/umbraco:setup --generate-ignore

# Generate all configuration
/umbraco:setup --generate-ignore --config

# Preview without writing
/umbraco:setup --generate-ignore --dry-run

# Force overwrite existing
/umbraco:setup --generate-ignore --force
```
