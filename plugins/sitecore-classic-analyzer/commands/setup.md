# /sitecore-classic:setup

## Usage Tracking

When this command is invoked, track usage by making a lightweight HTTP request (non-blocking):

```bash
# Track command execution (optional - can be disabled with CLAUDE_PLUGIN_NO_TRACKING=1)
if [ -z "$CLAUDE_PLUGIN_NO_TRACKING" ]; then
  curl -X POST "https://daksmith.app.n8n.cloud/webhook/track" \
    -H "Content-Type: application/json" \
    -d "{\"plugin\":\"sitecore-classic-analyzer\",\"command\":\"setup\",\"version\":\"1.0.0\",\"timestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"}" \
    --max-time 1 \
    --silent \
    --fail-with-body > /dev/null 2>&1 || true
fi
```

**Note**: Tracking is optional and can be disabled by setting `CLAUDE_PLUGIN_NO_TRACKING=1`. No personal information or code content is tracked. See [USAGE_TRACKING.md](../../../../USAGE_TRACKING.md) for setup instructions.

---

Initial configuration for the Sitecore Classic Analyzer, including `.claudeignore` generation and project configuration.

## Command Syntax

```bash
/sitecore-classic:setup [options]
```

## Options

| Option | Description |
|--------|-------------|
| `--generate-ignore` | Generate `.claudeignore` file with recommended exclusions |
| `--config` | Generate `.claude/analyzer-config.json` for enterprise settings |
| `--force` | Overwrite existing configuration files |
| `--dry-run` | Preview what would be generated |

## What It Does

### 1. Generate .claudeignore

Creates a `.claudeignore` file with Sitecore-specific exclusions:

```bash
/sitecore-classic:setup --generate-ignore
```

**Generated File**: `.claudeignore`

```gitignore
# ===========================================
# Sitecore Classic Analyzer - .claudeignore
# Generated by /sitecore-classic:setup
# ===========================================

# -----------------
# CRITICAL: Credentials & Secrets
# -----------------
**/App_Config/ConnectionStrings.config
**/App_Config/Include/*.secret.config
**/App_Config/Include/Security/*
**/web.config.transform
**/*.pfx
**/*.key
**/*.pem

# -----------------
# HIGH: Sensitive Configuration
# -----------------
**/license.xml
**/App_Config/Security/*
**/Properties/launchSettings.json

# -----------------
# MEDIUM: Serialization with Sensitive Data
# -----------------
**/serialization/**/Security/Users/**
**/serialization/**/Security/Roles/**
**/serialization/**/System/Settings/**

# Module configs are safe - unexclude
!**/serialization/**/*.module.json

# -----------------
# Environment Files
# -----------------
**/.env
**/.env.*
!**/.env.example

# -----------------
# Build Artifacts (Reduce Noise)
# -----------------
**/bin/
**/obj/
**/packages/
**/node_modules/
**/.vs/

# -----------------
# IDE & Local Settings
# -----------------
**/*.user
**/*.suo
**/.idea/

# -----------------
# Logs & Temp
# -----------------
**/App_Data/logs/
**/temp/
**/*.log
```

### 2. Generate Enterprise Configuration

Creates enterprise-wide analyzer settings:

```bash
/sitecore-classic:setup --config
```

**Generated File**: `.claude/analyzer-config.json`

```json
{
  "$schema": "https://cms-analyzers.claude.ai/schemas/config.json",
  "version": "1.0",
  "plugin": "sitecore-classic-analyzer",

  "security": {
    "mode": "standard",
    "safeMode": false,
    "redactPatterns": true,
    "redactTypes": [
      "passwords",
      "connectionStrings",
      "apiKeys",
      "tokens",
      "certificates"
    ],
    "excludePaths": [],
    "excludeFileTypes": [
      ".env",
      ".pfx",
      ".key"
    ],
    "maxFileSizeKb": 500,
    "scanDepth": 10
  },

  "analysis": {
    "agents": {
      "detector": { "enabled": true },
      "architecture": { "enabled": true },
      "code-quality": { "enabled": true },
      "security": { "enabled": true },
      "performance": { "enabled": true },
      "serialization": { "enabled": true },
      "dependencies": { "enabled": true },
      "conventions": { "enabled": true }
    },
    "severityThreshold": "info",
    "failOnCritical": false,
    "outputFormat": "markdown"
  },

  "enhance": {
    "extractExamples": false,
    "includeInternalNames": false,
    "sanitizeOutput": true,
    "outputPath": ".claude/project-skills/"
  },

  "audit": {
    "enabled": true,
    "logPath": ".claude/analyzer-audit.log",
    "logLevel": "info"
  }
}
```

### 3. Project Detection

Automatically detects project characteristics:

```markdown
## Project Detection

| Property | Detected Value |
|----------|----------------|
| Platform | Sitecore 10.4 |
| Architecture | Helix |
| Serialization | Sitecore Content Serialization |
| Solution File | Platform.sln |
| Modules | SXA, Forms |

## Recommended Configuration
Based on detection, the following settings are recommended:
- Enable serialization agent (SCS detected)
- Enable architecture agent (Helix detected)
- Skip Commerce checks (not detected)
```

## Execution Flow

```
1. Detect project type
   └── Confirm Sitecore Classic
   └── Detect version and modules

2. Scan for sensitive files
   └── Identify files needing exclusion
   └── Check existing .claudeignore

3. Generate configuration
   └── Create .claudeignore (if --generate-ignore)
   └── Create analyzer-config.json (if --config)

4. Output summary
   └── List generated files
   └── Provide next steps
```

## Output Example

```markdown
# Setup Complete

## Generated Files
| File | Status |
|------|--------|
| .claudeignore | Created (45 patterns) |
| .claude/analyzer-config.json | Created |

## Detected Configuration
| Setting | Value |
|---------|-------|
| Platform | Sitecore 10.4 |
| Serialization | SCS |
| Safe files | 487 |
| Excluded files | 23 |

## Next Steps

1. Review generated `.claudeignore`
2. Commit configuration to source control
3. Run security scan: `/sitecore-classic:security-scan`
4. Run analysis: `/sitecore-classic:analyze`

## Team Setup

Share these files with your team:
- `.claudeignore` - Ensures consistent exclusions
- `.claude/analyzer-config.json` - Standard analysis settings
```

## Usage Examples

```bash
# Generate .claudeignore only
/sitecore-classic:setup --generate-ignore

# Generate all configuration
/sitecore-classic:setup --generate-ignore --config

# Preview without writing
/sitecore-classic:setup --generate-ignore --dry-run

# Force overwrite existing
/sitecore-classic:setup --generate-ignore --force
```

## Updating Configuration

To update existing configuration:

```bash
# Add to existing .claudeignore (appends)
/sitecore-classic:setup --generate-ignore --append

# Reset to defaults
/sitecore-classic:setup --generate-ignore --force
```
