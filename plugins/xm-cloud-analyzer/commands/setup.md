# /xm-cloud:setup

## Usage Tracking

When this command is invoked, track usage by making a lightweight HTTP request (non-blocking):

```bash
# Track command execution (optional - can be disabled with CLAUDE_PLUGIN_NO_TRACKING=1)
if [ -z "$CLAUDE_PLUGIN_NO_TRACKING" ]; then
  curl -X POST "https://daksmith.app.n8n.cloud/webhook/track" \
    -H "Content-Type: application/json" \
    -d "{\"plugin\":\"xm-cloud-analyzer\",\"command\":\"setup\",\"version\":\"1.0.0\",\"timestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"}" \
    --max-time 1 \
    --silent \
    --fail-with-body > /dev/null 2>&1 || true
fi
```

**Note**: Tracking is optional and can be disabled by setting `CLAUDE_PLUGIN_NO_TRACKING=1`. No personal information or code content is tracked. See [USAGE_TRACKING.md](../../../../USAGE_TRACKING.md) for setup instructions.

---

Initial configuration for the XM Cloud Analyzer, including `.claudeignore` generation and project configuration.

## Command Syntax

```bash
/xm-cloud:setup [options]
```

## Options

| Option | Description |
|--------|-------------|
| `--generate-ignore` | Generate `.claudeignore` file with recommended exclusions |
| `--config` | Generate `.claude/analyzer-config.json` for enterprise settings |
| `--force` | Overwrite existing configuration files |
| `--dry-run` | Preview what would be generated |

## What It Does

### 1. Generate .claudeignore

Creates a `.claudeignore` file with XM Cloud-specific exclusions:

```bash
/xm-cloud:setup --generate-ignore
```

**Generated File**: `.claudeignore`

```gitignore
# ===========================================
# XM Cloud Analyzer - .claudeignore
# Generated by /xm-cloud:setup
# ===========================================

# -----------------
# CRITICAL: Environment & Secrets
# -----------------
.env
.env.local
.env.development
.env.production
.env.*
!.env.example

# -----------------
# HIGH: Deployment Configurations
# -----------------
vercel.json
netlify.toml
.vercel/
.netlify/

# -----------------
# HIGH: API Keys & Certificates
# -----------------
**/*.pem
**/*.key
**/*.p12
**/secrets/

# -----------------
# Build Output (Reduce Noise)
# -----------------
.next/
out/
build/
dist/
node_modules/

# -----------------
# IDE & Local Settings
# -----------------
.vscode/
.idea/
*.local

# -----------------
# Logs & Cache
# -----------------
*.log
.cache/
.turbo/
```

### 2. Generate Enterprise Configuration

Creates enterprise-wide analyzer settings:

```bash
/xm-cloud:setup --config
```

**Generated File**: `.claude/analyzer-config.json`

```json
{
  "$schema": "https://cms-analyzers.claude.ai/schemas/config.json",
  "version": "1.0",
  "plugin": "xm-cloud-analyzer",

  "security": {
    "mode": "standard",
    "safeMode": false,
    "redactPatterns": true,
    "redactTypes": [
      "apiKeys",
      "tokens",
      "endpoints",
      "secrets"
    ],
    "excludePaths": [],
    "excludeFileTypes": [
      ".env",
      ".pem",
      ".key"
    ],
    "maxFileSizeKb": 500,
    "scanDepth": 10
  },

  "analysis": {
    "agents": {
      "detector": { "enabled": true },
      "architecture": { "enabled": true },
      "code-quality": { "enabled": true },
      "security": { "enabled": true },
      "performance": { "enabled": true },
      "graphql": { "enabled": true },
      "dependencies": { "enabled": true },
      "conventions": { "enabled": true }
    },
    "severityThreshold": "info",
    "failOnCritical": false,
    "outputFormat": "markdown"
  },

  "enhance": {
    "extractExamples": false,
    "includeInternalNames": false,
    "sanitizeOutput": true,
    "outputPath": ".claude/skills/"
  },

  "audit": {
    "enabled": true,
    "logPath": ".claude/analyzer-audit.log",
    "logLevel": "info"
  }
}
```

### 3. Project Detection

Automatically detects project characteristics:

```markdown
## Project Detection

| Property | Detected Value |
|----------|----------------|
| Platform | XM Cloud |
| JSS Version | 22.0 |
| Next.js Version | 14.2 |
| Router | App Router |
| Deployment | Vercel |

## Recommended Configuration
Based on detection, the following settings are recommended:
- Enable GraphQL agent (queries detected)
- Enable performance agent (SSR pages detected)
- Configure TypeScript strict checks
```

## Execution Flow

```
1. Detect project type
   └── Confirm XM Cloud
   └── Detect versions and configuration

2. Scan for sensitive files
   └── Identify files needing exclusion
   └── Check existing .claudeignore

3. Generate configuration
   └── Create .claudeignore (if --generate-ignore)
   └── Create analyzer-config.json (if --config)

4. Output summary
   └── List generated files
   └── Provide next steps
```

## Output Example

```markdown
# Setup Complete

## Generated Files
| File | Status |
|------|--------|
| .claudeignore | Created (28 patterns) |
| .claude/analyzer-config.json | Created |

## Detected Configuration
| Setting | Value |
|---------|-------|
| Platform | XM Cloud |
| JSS Version | 22.0 |
| Safe files | 167 |
| Excluded files | 12 |

## Next Steps

1. Review generated `.claudeignore`
2. Commit configuration to source control
3. Run security scan: `/xm-cloud:security-scan`
4. Run analysis: `/xm-cloud:analyze`

## Team Setup

Share these files with your team:
- `.claudeignore` - Ensures consistent exclusions
- `.claude/analyzer-config.json` - Standard analysis settings
```

## Usage Examples

```bash
# Generate .claudeignore only
/xm-cloud:setup --generate-ignore

# Generate all configuration
/xm-cloud:setup --generate-ignore --config

# Preview without writing
/xm-cloud:setup --generate-ignore --dry-run

# Force overwrite existing
/xm-cloud:setup --generate-ignore --force
```
